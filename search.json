[
  {
    "objectID": "posts/welcome/index.html",
    "href": "posts/welcome/index.html",
    "title": "Welcome To My Blog",
    "section": "",
    "text": "This is the first post in a Quarto blog. Welcome!\nSince this post doesn’t specify an explicit image, the first image in the post will be used in the listing page of posts."
  },
  {
    "objectID": "posts/welcome/index.html#bla-22",
    "href": "posts/welcome/index.html#bla-22",
    "title": "Welcome To My Blog",
    "section": "bla 22",
    "text": "bla 22"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this blog"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Notes on stuff",
    "section": "",
    "text": "Extended wetlands priority habitats\n\n\n\n\n\n\n\n\n\n\n\n\nIacopo Ferrario, Iacopo Ferrario\n\n\n\n\n\n\n  \n\n\n\n\nWelcome To My Blog\n\n\n\n\n\n\n\nnews\n\n\n\n\n\n\n\n\n\n\n\nOct 29, 2023\n\n\nIacopo Ferrario, Tristan O’Malley\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "posts/2023-10-31_nb/extwet_priority_habitats.html",
    "href": "posts/2023-10-31_nb/extwet_priority_habitats.html",
    "title": "Extended wetlands priority habitats",
    "section": "",
    "text": "from pathlib import Path\nimport pandas as pd\n\nimport os\nos.environ['USE_PYGEOS'] = '0'\nimport geopandas as gpd\n\n\n# import colorcet as cc\nimport datashader as ds\n# import datashader.transfer_functions as tf\n\nimport holoviews as hv\nfrom holoviews.operation.datashader import rasterize\nfrom holoviews import opts\n\nimport geoviews as gv\nimport cartopy.crs as ccrs\n\nfrom spatialpandas import GeoDataFrame\n\nfrom dask import dataframe as dd\n\ngv.extension('bokeh')\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n  \n  \n\n\n\n\n\n\n\n\nPrepared plots showing extended wetland priority habitats.\nTried Holoviews/Geoviews/Datashader for interactive plots, they works very well.\nTried jupyterlite and pyodide but there are no wheels available for datashader and co. so micropip was not able to run with them\n\n\nimport requests\nimport io\n\n\nimport sys\nif not sys.warnoptions:\n    import warnings\n    warnings.simplefilter(\"ignore\")\n\n\nurl = 'https://github.com/iacopoff/iacopoff.github.io/raw/main/data/n2k_extwet_priority_poly_onehot_s.fgb'\n\n\ndn = requests.get(url).content\n\n\ndf = gpd.read_file(io.BytesIO(dn))\n\n\nurl2 = 'https://github.com/iacopoff/iacopoff.github.io/raw/main/data/annex_I_extended_wetlands.csv'\ndn2 = requests.get(url2).content\nlookup = pd.read_csv(io.StringIO(dn2.decode('utf-8'))).set_index('habitatcode')\n\n\n# dpath = Path('~').expanduser()  / 'eos_data/KCEO/uc_wetlands/n2k_aoi/GIS'\n\n\n#fpath = dpath / 'n2k_extwet_priority_poly_onehot_s.fgb'\n\n\n#df = gpd.read_file(fpath)\n#lookup = pd.read_csv(dpath / 'annex_I_extended_wetlands.csv').set_index('habitatcode')\n\n\nhcodes = df.filter(regex='\\d',axis=1).columns.tolist()\n\n\ndf['n_pr_hb'] = df.filter(regex='\\d',axis=1).sum(axis=1)\n\n\ndf = df.to_crs(3857)\n\n\ndf_sp = GeoDataFrame(df)\n\n\nddf = dd.from_pandas(df_sp, npartitions=10)\n\n\n# cvs = ds.Canvas()\n# tf.shade(cvs.polygons(ddf[ddf['3170'] == 1], geometry='geometry', agg=ds.mean('n_pr_hb')), cmap=cc.kg);\n\n\nbm = hv.element.tiles.EsriUSATopo()\n\n\ndef get_canvas(hcodes, bm):\n    out = []\n    for h in hcodes:\n        out.append(bm * rasterize(hv.Polygons(ddf[ddf[h] == 1], vdims=['sitename','n_pr_hb']), aggregator=ds.mean('n_pr_hb')).opts(\n            colorbar=True, cmap='bgy',fontsize={'title':8}))\n    return out\n\n\nouts = get_canvas(hcodes, bm)\n\n\n# def compute_partitions(el):\n#     n = ddf[ddf['3170'] == 1].cx_partitions[slice(*el.range('x')), slice(*el.range('y'))].npartitions\n#     return el.opts(title=f'Population by country (npartitions: {n})')\n\n# bm * out1.apply(compute_partitions).opts(width=700, height=500, tools=[\"hover\"])\n\n\n# opts.Polygons(logz=True, tools=['hover'], xaxis=None, yaxis=None,\n#                show_grid=False, show_frame=False, width=500, height=500,\n#                color_index='das', colorbar=True, toolbar='above', line_color='white')\n\n\nl = hv.Layout([ts.opts(width=400, height=300).relabel(name + \": \" + lookup.loc[name][0]) for name, ts in zip(hcodes,outs)]).opts(\n    opts.Tiles(xaxis=None, yaxis=None, width=100, height=100)).cols(3)\n\n\nl\n\n\n\n\n\n  \n\n\n\n\n\n# import matplotlib.pyplot as plt\n# import cartopy.crs as ccrs\n\n# from cartopy.io.img_tiles import Stamen\n\n\n# tiler = Stamen('terrain-background')\n# mercator = tiler.crs\n\n# # df = df.set_index('sitecode')\n\n# def plot_fig(hcodes):\n#     for h in hcodes:\n#         fig = plt.figure(figsize=(10,8))\n#         ax = fig.add_subplot(1, 1, 1, projection=mercator)\n#         ax.set_extent([-15, 37, 34, 71], crs=ccrs.PlateCarree())\n\n#         ax.add_image(tiler, 6, alpha=0.8)\n#         ax.coastlines('10m',color='grey', )\n#         df[df[h] ==1].plot(ax=ax, color='red', linewidth=0.5) # column='n_pr_hb', ax=ax, categorical=True, legend=True, cmap='red')\n\n        \n#         plt.title(h + ': ' + lookup.loc[h][0])\n#         fig.savefig(dpath / f'../habitats/habitat_{h}.png', dpi=300)\n\n\n#plot_fig(hcodes)\n\n\n# fig = plt.figure(figsize=(15,13))\n# ax = fig.add_subplot(1, 1, 1, projection=mercator)\n# ax.set_extent([-15, 38, 34, 72], crs=ccrs.PlateCarree())\n\n# ax.add_image(tiler, 6, alpha=0.8)\n\n# df.plot(column='n_pr_hb', ax=ax, categorical=True, legend=True, cmap='jet')\n\n# #ax.coastlines('10m',color='grey')\n# plt.title(\"Count of 'wet' priority habitats in N2K sites\")\n# fig.savefig(dpath / f'../habitats/priority_habitats_count.png', dpi=300)\n\n\n\n\nReusehttps://creativecommons.org/licenses/by/4.0/CitationBibTeX citation:@online{ferrario,\n  author = {Ferrario, Iacopo and Ferrario, Iacopo},\n  title = {Extended Wetlands Priority Habitats},\n  url = {https://github.com/iacopoff/iacopoff.github.io/posts/2023-10-31_nb/extwet_priority_habitats.html},\n  langid = {en}\n}\nFor attribution, please cite this work as:\nFerrario, Iacopo, and Iacopo Ferrario. n.d. “Extended Wetlands\nPriority Habitats.” https://github.com/iacopoff/iacopoff.github.io/posts/2023-10-31_nb/extwet_priority_habitats.html."
  }
]